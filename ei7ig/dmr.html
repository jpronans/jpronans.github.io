<!DOCTYPE html>
<html>
	<head>
	<title>Digital Mobile Radio</title>
	  <meta charset="UTF-8">
	  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
	  <script type= "text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.8/handlebars.min.js"></script>
	  <link rel="stylesheet" media="screen" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.10/semantic.min.css">
	</head>
	<body bgcolor="#ffffff" link="#0000ff" vlink="#800080">
	  	<!-- navigation menu template -->
	  	<div class="navbar-menu-placeholder"></div>
	  	<script src="public/javascript/navbar-menu.js"></script>
      <font size="-2"> Last updated: 20200620</font></p>
    <section>
      <h1>Digital Mobile Radio</h1>
    <h2>Ireland Proposed Talkgroups</h2>
    <p> The first thing to remember is that timeslot usage really only matters to repeaters not hotspots or simplex gateways. Broadly, the philisophy is keep local traffic on <b>Slot 2</b>, everyting else on <b>Slot 1</b>. This rule of thumb should allow initial contact to be establised on Talkgroup 2722 or Talkgroup 8, almost all of the time. Sure, if <b>Slot 1</b> is busy, then feel free to stay on <b>Slot 2</b>:</p>
    <p>So here is a list of some Talkgroups specific to Ireland on Brandmeister:</p>

    <ul>
    <li>7 (Slot1) Provincal Cluster</li>    
    <li>8 (Slot2)- Repeater Group Cluster</li> 
    <li>9 (S1 & S2) - Local access</li>
    <li>91 (S1) - Worldwide</li>
    <li>2722 (S2) - Ireland Calling Channel (Also accessible via reflector 4780 on BrandMeister)</li>
    <li>2723 (S1) - Ireland Chat</li>
    <li>2724 (S1) - Ireland Wires Bridge/XLX353</li>
    <li>27240 (S1) - Southern Ireland Analogue Repeater Network</li>
    <li>27246 (S1) - XLX 922 E</li>
    <li>27247 (S1) - XLX 925 C</li>
    <li>27248 (S1) - XLX 925 F</li>
    <li>27249 (S1) - XLX 925 B</li>
    <li>27250 (see example below) - Connacht - (EI7AKR, EI7LRD, EI7RHD, EJ7IBD currently active)</li>
    <li>27251 (see example below) - Leinster - (EI7MLD currently active)</li>
    <li>27252 (see example below) - Munster - (EI7CDD, EI7WCD currently active)</li>
    <li>27253 (see example below) - Ulster - (GB7CX, GB8KA currently active)</li>
    <li>27254 (see example below) - Southern Ireland Repeater Group (EI7CDD, EI7WCD, EI7MLD currently active)</li>
    <li>27255 (see example below) - Galway Digital Radio Group (EI7AKR, EI7LRD, EI7RHD, EJ7IBD currently active)</li>
    <li>27291 (S1 Alternate & S2 Primary) - AREN Tac 1</li>
    <li>272907 (S1) - IRL JOTA</li>
    <li>272997 (S1&S2) - Parrot/Echo</li>
    <li>272999 - APRS</li>
    <li>9990 - Parrot/Echo</li>
    </ul>
   

    <h2>Timeslots</h2>
    <h3>Sample programming for EI7CDD and EI7WCD (Both in Waterford)</h3>
    In Keeping with that philosophy, let me given an example. I am based in Waterford, Munster. Here is suggested programming of talkgroups using <b>Slot 1</b> of the EI7CDD and EI7WCD repeaters. Bearing in mind that these two repeaters are in the Munster (TG7) and Southern Ireland Repeater Group (TG8) Clusters 
    <ul>
    <li>7 - Provincal Cluster (Automatically set to Munster in this case)</li>
    <li>9 - Local access</li>
    <li>91 - Worldwide</li>
    <li>2723 - Ireland Chat</li>
    <li>2724 - Ireland WIRES Bridge/XLX353</li>
    <li>27240 - Southern Ireland Analogue Repeater Network</li>
    <li>27250 - Connacht</li>
    <li>27251 - Leinster</li>
    <li>27253 - Ulster</li>
    <li>25255 - Galway Digital Radio Group</li>
    </ul>

    and in <b>Slot 2</b>
    <ul>
    <li>8 - Repeater Group Cluster (Automatically set to Southern Ireland Repeater Group in this case)</li>
    <li>9 - Local access</li>
    <li>2722 - Ireland Calling Channel</li>
    </ul>
  
    <h3>Sample programming for EI7MLD (Mt. Leinster, Co. Carlow)</h3>
    Now, bear in mind that this repeater is in the Leinster (TG7) and Southern Ireland Repeater Group (TG8) Clusters. <b>Slot 1</b>: 
    <ul>
    <li>7 - Provincal Cluster (Automatically set to Leinster in this case)</li>
    <li>9 - Local access</li>
    <li>2723 - Ireland Chat</li>
    <li>2724 - Ireland WIRES Bridge/XLX353</li>
    <li>27240 - Southern Ireland Repeater Network</li>
    <li>27250 - Connacht</li>
    <li>27252 - Munster</li>
    <li>27253 - Ulster</li>
    <li>25255 - Galway Digital Radio Group</li>
    </ul>

    and in <b>Slot 2</b>:
    <ul>
    <li>8 - Repeater Group Cluster (Automaticall set to Southern Ireland Repeater Group in this case)</li>
    <li>9 - Local access</li>
    <li>2722 - Ireland Calling Channel</li>
    </ul>

    <h3>Sample programming for EI7AKR (Abbeyknockmoy, Co. Galway)</h3>
    Now, consider a different area. Bear in mind that this repeater is in the Connacht (TG7) and Galway Digital Radio Group (TG8) Clusters. <b>Slot 1</b>: 
    <ul>
    <li>7 - Provincal Cluster (Automatically set to Connacht in this case)</li>
    <li>9 - Local access</li>
    <li>2723 - Ireland Chat</li>
    <li>2724 - Ireland WIRES Bridge/XLX353</li>
    <li>27240 - Southern Ireland Repeater Network</li>
    <li>27251 - Leinster</li>
    <li>27252 - Munster</li>
    <li>27253 - Ulster</li>
    <li>25254 - Southern Ireland Repeater Group</li>
    </ul>

    and in <b>Slot 2</b>
    <ul>
    <li>8 - Repeater Group Cluster (Galway Digital Radio Group in this case)</li>
    <li>9 - Local access</li>
    <li>2722 - Ireland Calling Channel</li>
    </ul>

    
    <h2>Reflectors</h2>
    Reflectors are simply dynamic links to talkgroups. Limited to only be used on slot 2 (Brandmeister). In all likelyhood reflector functionality will eventually stop being supported.

    <h2>Presentation</h2>
    <p>In 2018 I gave a presentation at the <a href="http://www.irts.ie">IRTS</a> AGM and also at a recent <a href="http://www.searg.ie">SEARG</a> club meeting on DMR and Brandmeister in Ireland. It is available <a href="./dmr_presentation/index.html">here.</a></p>

    <h2>Useful Links</h2>
    <ul>
    <li><a href="https://sirnrepeaters.blogspot.ie/">Southern Ireland Repeater Group</a>
    <li><a href="https://register.ham-digital.org/">DMR ID Registration</a>
    <li><a href="https://www.radioid.net/database/search#!">DMR ID Search</a>
    <li><a href="https://brandmeister.network/">Brandmeister</a></li>
    <li><a href="https://wiki.brandmeister.network/index.php/Ireland">Ireland entry on BM Wiki</a>
    <li><a href="https://brandmeister.network/?page=lh&jsonquery=%7B%22condition%22%3A%22AND%22%2C%22rules%22%3A%5B%7B%22id%22%3A%22Master%22%2C%22field%22%3A%22Master%22%2C%22type%22%3A%22string%22%2C%22input%22%3A%22text%22%2C%22operator%22%3A%22contains%22%2C%22value%22%3A%222721%22%7D%5D%7D">Ireland Lastheard</a>
    <li><a href="https://www.youtube.com/watch?v=sDBosrVDrOA">Programming the MD-390/RT8</a> (Youtube)</li>
    <li><a href="http://brandmeisternetwork.blogspot.ie/2016/12/brandmeister-reflectors-talkgroups-list.html">On Brandmeister reflectors</a></li>
    <li><a href="https://brandmeister.network/?page=login&returnurl=%2F%3Fpage%3Dselfcare">Brandmeister Selfcare</a>
    <li><a href="http://brandmeister-uk.co.uk/">Brandmeister UK</a>
    <li><a href="http://www.amateurradio.digital/wizard.php">Digital Contacts Wizard</a>

    <li><a href="http://www.dmr-marc.net/media/Amateur_Radio_Guide_to_DMR_Rev_I_20150510.pdf">Amateur Guide to DMR</a> from 2015. No mention of Brandmeister</li>
    <li><a href="public/files/codeplug-ei7ig.rdt">My current example codeplug</a> for my Retevis RT8 (last uploaded 2019-10-14)</li>
    <li><a href="http://www.royalsignals.org.uk/temp/DMR-APRS-Setup-Info.pdf">Motorola DM4600 DMR/APRS Howto</a></li>
    </ul>
    </section>
    <section>
    <h3>Codeplug Editors</h3>
    <ul>
    <li><a href="http://https://www.miklor.com/DMR/DMR-380-CPEditor.php>">Mikor Codeplug Editor</a></li>
    <li><a href="https://www.farnsworth.org/dale/codeplug/editcp/">Editcp</a></li>
    </ul>
    <p>Apart from the Manufacturers own programming software. The only other tool I have used are <a href="https://www.farnsworth.org/dale/codeplug/editcp/">Editcp</a> for programming and <a href="https://github.com/travisgoodspeed/md380tools">md380tools</a> for firmware updates.</p>   
    </section>
    <section>
    <h2>Radios</h2>
      <p>
        I currently have the Retevis <a href="http://www.retevis.com/rt8/">RT8</a>, an <a href="https://www.retevis.com/ailunce-hd1-dual-band-dmr-digital-radio">Ailunce HD1</a> and  a <a href="https://www.motorolasolutions.com/en_xu/products/mototrbo/dm4000-series-mobile-radios/dm4600-dm4601.html#tabproductinfo">Motorola DM4600</a>.
        I'm happy to share my own codeplugs if asked. Contact details on <a href="https://www.hamqth.com/">HamQTH</a> or <a href="www.qrz.com">QRZ</a>.
      </p>
    </section>
  
    <section class="ui raised segment">
      <h1 id="rt8">Extracting GPS Data from the Retevis RT8</h1>
      <p>
      These notes are largely for my own benefit. My motiviation was pretty simple.  I had purchased the Retevis RT8 and, as I am interested in the use of APRS and other tracking technologies for Public Service (<a href="http://www.aren.ie">AREN</a>), I simply wanted to get the GPS function working.
      </p>
      <p>
      So with that in mind I started by turning on debugging in MMDVM and see what I could figure out. I posted a <a href="https://groups.yahoo.com/neo/groups/mmdvm/conversations/messages/13009">question</a> to the MMDVM group outlining my initial findings. 
      </p>
      <p>
      From that, I had some discussions with Jonathan Naylor, G4KLX regarding the UDT Header, and we determined that MMDVM was dropping a frame at the end of each transmission when the GPS was enabled (<a href="https://github.com/g4klx/MMDVMHost/commit/68b8ba031fdc50a5c2603275c892fe6ce6e9ce6f">the fix</a>).
      </p>
      <p>
      I also came across <a href="https://groups.google.com/forum/#!topic/md380tools/GDm-aOuPV2g">this</a> thread where Carlos, EB4FBZ had done some work decoding the GPS data from the MD-390.
      </p>
      <pre>
        Hello Michael, these are my notes in 0 based indexing:

        bit 0: Not used
        bit 1 : 1=N, 0=S
        bit 2 : 1=E, 0=W
        bit 3 : Fix
        bits(4:10): Speed in knots/2
        bits(11:17): Latitude. Degrees
        bits(18:23): Latitude. Minutes integer part
        bits(24:37): Latitude. Minutes decimal part
        bits(38:45): Longitude. Degrees
        bits(46:51): Longitude. Minutes integer part
        bits(52:65): Longitude. Minutes decimal part
        bits(66:79): Altitude in meters, only least 8bits used (bug)
        bits(80:95): Garbage?

        This is working on BM network since 2 weeks ago, i'm pretty sure it's correct. I injected simulated NMEA frames into the radio instead of the real GPS ones and tested each value.

        Best regards,
        Carlos EB4FBZ
      </pre>
      <p>
      So with this information I set about figuring out the data stream. This was a pretty much done by brute force i.e. lots of debugging statements.
      </p>
      <p>
      Firstly I set about figuring out what my RT8 was sending this was the first packet I saw:
      </p>
      <pre>
      00 05 04 2A 67 29 81 32 00 1B 42 A8
      </pre>
      <p>
      Breaking the bytes down further (from left to right) into individual bits (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236101/02.02.01_60/ts_10236101v020201p.pdf">ETSI TS 102 361-1 - V2.2.1</a> Page 79), this is what you get:
      <pre>
      00 = 0000 0000  
      Bit  7   = Individial (0) or Talkgroup (1) is the destination  
           6   = Response Requested (1) 
           5   = 0
           4   = 0
      Bits 3-0 = 0000 = UDT Data transport Format is Binary (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236101/02.02.01_60/ts_10236101v020201p.pdf">ETSI TS 102 361-1 - V2.2.1 Page 109</a>)

      05 = 0000 0101
      Bits 7-4 = 0000 = UDT Service Access Point ID (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236101/02.02.01_60/ts_10236101v020201p.pdf">ETSI TS 102 361-1 - V2.2.1 Page 103</a>)
      Bist 3-0 = 0101 = NMEA location coded (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236101/02.02.01_60/ts_10236101v020201p.pdf">ETSI TS 102 361-1 - V2.2.1 Page 109</a>)


      04 2A 67 = 0000 0100 0020 1100 0101 0111 = Destination Logical Link ID = 272999 (Destination DMR ID set in my Codeplug)

      29 81 32 = 0010 1001 1000 0001 0011 0010 = Source Logical Link ID = 2720050 (My DMR ID)

      00 = 0000 0000
      Bits 7-3 = 00000 = Pad Nibble
      Bit    2 = 0     = Reserved
      Bits 1-0 = 00    = 1 Appended Data UDT Blocks 
      
      1B = 0001 1011   
      Bit    7 = 0      = Supplementary Flag
             6 = 0      = Protect Flag (Reserved for Future Use)
      Bits 5-0 = 011011 = UDT Opcode = Unified Data Transport inbound Header (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236104/01.07.01_60/ts_10236104v010701p.pdf">ETSI TS 102-361-4 v1.7.1</a>, page 252 Table B.1)

      42 A8 = Header CRC which I really wasn't concerned about.   
      </pre>

      Noticing that '00' meant '1 Appended Data UDT Block' was the first useful thing I found.

      So, now to deal with the appended data frame. It turns out this is in the Short NMEA format (see <a href="http://www.etsi.org/deliver/etsi_ts/102300_102399/10236104/01.07.01_60/ts_10236104v010701p.pdf">ETSI TS 102-361-4 v1.7.1</a>, page 262).  
      <pre>
      50 0D 09 98 00 1C 96 50 80 3F C7 B8
      </pre>
      <pre>
      50 = 0101 0000 
      Bit    7 = 0 = Encrypted (1), not encrypted (0)         = Not encrypted
             6 = 1 = Latitude Direction, North(1), South(0)   = North
             5 = 0 = Longitude Direction, East(1), West(0)    = West
             4 = 1 = GPS Quality Indicator Fix (1), No Fix(0) = GPS Fix
      Bits 3-0 = 0000 = Top 4 bits of the Speed in knots
      
      0D = 0000 1101
      Bits 7-5 = 000   = Bottom 3 bits of the Speed in knots (127 = Greater than 126 knots)
      Bits 4-0 = 01101 = Top 5 bits of Latitude Degrees 

      Speed = 0000000 = 0 Knots

      The notes from Carlos, EB4FBZ suggest that this is knots/2. I haven't had the opportunity to test this yet.
      
      09 = 0000 1001 
      Bits 7-6 = 00     = Bottom 2 bits of Latitude Degrees (0-89)
      Bits 5-0 = 001001 = Latitude Minutes (00-59) 

      Latitude Degrees = 0110100 = 52 Degrees
      Latitude Minutes = 001001  = 9 Minutes
      
      98 = 1001 1000     = Top 8 bits of Latitude Fractions of minutes 

      00 = 0000 0000 
      Bits 7-2 = 000000  = Bottom 6 bits of Latitude Fractions of minutes (0000-9999)
      Bits 1=0 = 00      = Top two bits of Longitude Degrees

      Latitude fractions of minutes = 10 0110 0000 0000 = 9728

      1C = 0001 1100
      Bits 7-2 = 000111  = Bottom 6 bits of Longitude Degrees (000-179)
      bits 1-0 = 00      = Top two bits of Longitude Minutes
      
      Longitude Degrees = 0000 0111 = 7

      96 = 1001 0110 
      Bits 7-4 = 1001 = Bottom 4 bits of Longitude Minutes (00-59)
      Bits 3-0 = 0110 = Top 4 bits of Longitude Fractions of minutes 

      Longitude Minutes = 001001 = 9

      50 = 0101 0000 = Bits 10-3 of Longitude Fractions of minutes

      </pre>
      <p>
      At this point the Radio appears to diverge from the specifications as per the notes from Carlos EB4FBZ and I'm taking the next 14 bits as Altitude in Meters which appears to be correct so far.  I never tested what happens when the altitude is negative.
      </p>
      <pre>
      80 = 1000 0000 
      Bits 7-6 = 10 = Bottom two bits of Longitude Fractions of Minutes (0000-9999)
      
      Bits 5-0 = 00000 = Top 6 bits of Altitude
      Longitude fractions of minutes = 0110 0101 0000 10 = 6466

      3F = 0011 1111 = Bottom 8 bits of Altitude   

      Altitude = 00 0000 0011 1111 = 63 Meters
      </pre>
      <p>
      So fully decoded that gives:
      <ul>
      <li>Speed = 0</li>
      <li>52 9 9728 = 52.1662N</li> 
      <li>7 9 6446 = 7.1607W</li> 
      <li>Altitude = 63 Meters</li>
      </ul>

      Thats about all there was too it! Anyway, the point is moot as shortly after I figured this out, <a href="https://brandmeister.network">Brandmeister</a> added the support for the radio, so with the functionality now there. I didn't need to pursue it any further.

      The code still exists <a href="https://github.com/jpronans/DMRGateway">here</a> on github.
      </p>
    </section>

  
	</body>
</html>
